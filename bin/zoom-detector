#!/usr/bin/env ruby --yjit
# frozen_string_literal: true

ENV["BUNDLE_GEMFILE"] ||= File.expand_path("../Gemfile", __dir__)
$LOAD_PATH.unshift File.expand_path(File.join(File.dirname(__FILE__), "..", "lib"))

require "bundler/setup"
require "dotenv/load"
require "optparse"
require "legacy_zoom_detection"

options = { poll_seconds: 10, legacy: false }
opts = OptionParser.new
opts.on("-l", "--legacy-detection", "use the legacy zoom detection") do
  options[:legacy] = true
end
opts.on("-s SECONDS", "--seconds SECONDS",
        "Time in seconds to check the process table (only for legacy detection)") do |s|
  options[:poll_seconds] = s
end
opts.parse!

if options[:legacy]
  require "legacy_zoom_detection"
  LegacyZoomDetection.new(options).run
else
  require "macos_log_stream_detection"
  MacOSLogStreamDetection.new.run
end
